syntax = "proto3";

package roles.test_report_send.protos;

message CIRunnerProperty {
    string name = 1;
    string value = 2;
}

message CIRunner {
    string name = 1;
    optional string url = 2;
    repeated CIRunnerProperty properties= 3;
};

message CI {
    string url = 1;
    string type = 2;
    CIRunner runner = 3;
}

message ExecStatus {
    string status = 1;
    string message = 2;
    string created_at = 3;
    string duration = 4;
    string result = 5;
}

message Job {
    string name = 1;
    string url = 2;
    string build = 3;
    string build_url = 4;
    ExecStatus status = 5;
    string timestamp = 6;
    repeated string cause = 7;  // build cause
}

message Pipeline {
    string name = 1;
    string url = 2;
    string type = 3;
    ExecStatus status = 4;
}

message Change {
    string base_ref = 1;
    string head_ref = 2;
    string number = 3;
    string change_url = 4;
    string status = 5;
}

message Source {
    string repo = 1;
    string repo_path = 2;
    string repo_url = 3;
    string server_url = 4;
    string ref = 5;
    string ref_name = 6;
    string ref_type = 7;
    string sha = 8;
    string actor = 9;
    string actor_name = 10;
    string owner = 11;
    string event_payload = 12;
    Change change = 13;
}

message SWComponent {
    string name = 1;
    string version = 2;
    repeated string properties = 3;
}

message Product {
    SWComponent self = 1;
    repeated SWComponent dependencies = 2;
}

message ReportMetadata {
    bool is_ci = 1;
    CI ci = 2;
    Pipeline pipeline = 3;
    Job job = 4;
    Source source = 5;
    Product product = 6;
}

message TestStatistics {
    int32 tests = 1;
    int32 skipped = 2;
    int32 errors = 3;
    int32 failures = 4;
    float time = 5;
}

message Result {
    string message = 1;
    string status = 2;
}

message TestCase {
    string name = 1;
    string classname = 2;
    TestStatistics stats = 3;
    string system_err = 4;
    Result result = 5;
}

message TestSuiteProperty {
    string name = 1;
    string value = 2;
}

message TestSuite {
    string name = 1;
    TestStatistics stats = 2;
    repeated TestSuiteProperty properties = 9;
    repeated TestCase test_cases = 10;
}

message TestReport {
    TestStatistics stats = 1;
    repeated TestSuite test_suites = 3;
}

message TestReportEvent {
    ReportMetadata metadata = 3;
    TestReport test = 4;
}

message TestReportPayload {
    string host = 1;
    string sourcetype = 2;
    TestReportEvent event = 3;
    optional string source = 4;
    optional string _time = 5;
}
